ErrorResponse:
  type: object
  properties:
    ok: { type: boolean }
    error: { type: string }

AuthInfo:
  type: object
  properties:
    email: { type: string }
    role:
      type: string
      enum: [admin, user, unknown]

InstalledStateRow:
  type: object
  properties:
    id: { type: string }
    isInstalled: { type: boolean }
    installDirectory: { type: string }
    installSize:
      type: integer
      nullable: true
  required: [id, isInstalled]

InstalledPush:
  type: object
  properties:
    installed:
      type: array
      items: { type: string }
      description: >
        Backward-compatible:
        - string[] (old clients)
        - InstalledStateRow[] (new clients)
    items:
      oneOf:
        - type: string
        - $ref: "#/InstalledStateRow"
  required: [installed]

DeltaRequest:
  type: object
  properties:
    json:
      type: object
      additionalProperties:
        type: array
        items: { type: string }
    versions:
      type: object
      nullable: true
      description: >
        Optional per-entity metadata versions, keyed by collection then id.
        Example: { "games": { "<id>": "<ticks>" }, ... }.
      additionalProperties:
        type: object
        additionalProperties:
          type: string
          description: Client metadata version for the entity.
    installed:
      type: object
      nullable: true
      properties:
        count: { type: integer }
        hash: { type: string }

DeltaResponse:
  type: object
  properties:
    ok: { type: boolean }
    delta:
      type: object
      properties:
        toUpsert:
          type: object
          additionalProperties:
            type: array
            items: { type: string }
        toDelete:
          type: object
          additionalProperties:
            type: array
            items: { type: string }

EntityBody:
  type: object
  additionalProperties: true

SteamProfile:
  type: object
  description: Basic profile data returned by Steam OpenID helper
  properties:
    personaname:
      type: string
      nullable: true
    avatar:
      type: string
      format: uri
      nullable: true
    avatarfull:
      type: string
      format: uri
      nullable: true
    profileurl:
      type: string
      format: uri
      nullable: true

SteamConnection:
  type: object
  description: Steam link info stored on the InterLinked account
  properties:
    apiKey:
      type: string
      description: Steam Web API key stored per-account
    steamId:
      type: string
      description: SteamID64
      nullable: true
    linkedAt:
      type: string
      format: date-time
      description: When this Steam account was linked
      nullable: true
  required: [apiKey]

SteamWishlistItemDetails:
  type: object
  description: Hydrated store details for a Steam app
  properties:
    appid:
      type: integer
    name:
      type: string
    type:
      type: string
      nullable: true
    headerImage:
      type: string
      format: uri
      nullable: true
    price:
      type: object
      nullable: true
      properties:
        currency: { type: string }
        initial:
          type: integer
          description: Price in minor units (e.g. cents)
        final:
          type: integer
          description: Discounted price in minor units (e.g. cents)
        discountPercent:
          type: integer
    releaseDate:
      type: object
      nullable: true
      properties:
        date:
          type: string
        comingSoon:
          type: boolean

SteamWishlistItem:
  type: object
  description: Wishlist entry with optional hydrated game details
  properties:
    appid:
      type: integer
    priority:
      type: integer
    dateAdded:
      type: string
      format: date-time
    details:
      $ref: "#/SteamWishlistItemDetails"

SteamWishlistSnapshot:
  type: object
  description: Last synced wishlist snapshot for an account
  properties:
    lastSynced:
      type: string
      format: date-time
    items:
      type: array
      items:
        $ref: "#/SteamWishlistItem"

# -------------------------
# PLEX (NEW)
# -------------------------

PlexConnection:
  type: object
  description: Plex link info stored on the InterLinked admin account
  properties:
    serverUrl:
      type: string
      description: Base URL of Plex Media Server (PMS), e.g. http://192.168.1.10:32400
    clientIdentifier:
      type: string
      description: Stable app instance identifier used for Plex auth flows
    token:
      type: string
      nullable: true
      description: Plex account token (X-Plex-Token)
    linkedAt:
      type: string
      format: date-time
      nullable: true
    lastSyncedAt:
      type: string
      format: date-time
      nullable: true
    lastSyncOk:
      type: boolean
      nullable: true
    lastSyncError:
      type: string
      nullable: true
    lastPinId:
      type: integer
      nullable: true
    lastPinCode:
      type: string
      nullable: true
  required: [serverUrl, clientIdentifier]

PlexStatusResponse:
  type: object
  properties:
    ok: { type: boolean }
    connected: { type: boolean }
    serverUrl:
      type: string
      nullable: true
    linkedAt:
      type: string
      format: date-time
      nullable: true
    lastSyncedAt:
      type: string
      format: date-time
      nullable: true
    lastSyncOk:
      type: boolean
      nullable: true
    lastSyncError:
      type: string
      nullable: true

PlexAuthStartRequest:
  type: object
  properties:
    serverUrl:
      type: string
  required: [serverUrl]

PlexAuthStartResponse:
  type: object
  properties:
    ok: { type: boolean }
    authUrl:
      type: string
      description: URL the admin should open to authorize Plex
    pinId:
      type: integer
      description: PIN id used for polling

PlexAuthPollRequest:
  type: object
  properties:
    pinId:
      type: integer
      nullable: true
      description: Optional; if omitted server uses lastPinId stored on admin account

PlexAuthPollResponse:
  type: object
  properties:
    ok: { type: boolean }
    linked:
      type: boolean
      description: True once token has been obtained and stored

PlexSyncResponse:
  type: object
  properties:
    ok: { type: boolean }
    updatedAt:
      type: string
      format: date-time
    source:
      type: string
    serverUrl:
      type: string
    sectionCount:
      type: integer
    totalItems:
      type: integer
    totalDownloads:
      type: integer
