playnite_installed:
  post:
    tags: [Playnite]
    summary: Push installed state (installed + dir + size)
    security:
      - XAuthEmail: []
        XAuthPassword: []
        XClientId: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../components/schemas.yaml#/InstalledPush"
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              type: object
              properties:
                ok: { type: boolean }
                count: { type: integer }
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"

playnite_delta:
  post:
    tags: [Playnite]
    summary: Compute server delta
    description: >
      Compute the delta between client-known ids and server state, optionally
      using per-entity metadata versions to narrow upserts.
    security:
      - XAuthEmail: []
        XAuthPassword: []
        XClientId: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../components/schemas.yaml#/DeltaRequest"
    responses:
      "200":
        description: Delta
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/DeltaResponse"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "403":
        description: Forbidden (admin required)
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"

playnite_snapshot:
  post:
    tags: [Playnite]
    summary: Push full snapshot
    description: >
      Push a full snapshot object for the current user. The server stores it
      as `snapshot/snapshot.json` and annotates it with audit metadata
      (updatedAt, source, pushedBy, serverUpdatedAt).
    security:
      - XAuthEmail: []
        XAuthPassword: []
        XClientId: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../components/schemas.yaml#/EntityBody"
    responses:
      "200":
        description: Snapshot stored
        content:
          application/json:
            schema:
              type: object
              properties:
                ok: { type: boolean }
      "400":
        description: Bad request (invalid snapshot or missing email)
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "403":
        description: Forbidden (admin required)
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"

# Keep your existing collection enums as-is
playnite_collection:
  get:
    tags: [Playnite]
    summary: List all entities in a collection
    description: >
      Returns all JSON rows for the given collection from the server-side
      database. The result is a deterministically sorted array.
    security:
      - XAuthEmail: []
        XAuthPassword: []
        XClientId: []
    parameters:
      - name: collection
        in: path
        required: true
        schema:
          type: string
          enum:
            - games
            - companies
            - tags
            - sources
            - platforms
            - genres
            - categories
            - features
            - series
            - regions
            - ageratings
            - completionstatuses
            - filterpresets
            - importexclusions
    responses:
      "200":
        description: Collection items
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "../components/schemas.yaml#/EntityBody"
      "400":
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"

playnite_entity:
  parameters:
    - name: collection
      in: path
      required: true
      schema:
        type: string
        enum:
          - games
          - companies
          - tags
          - sources
          - platforms
          - genres
          - categories
          - features
          - series
          - regions
          - ageratings
          - completionstatuses
          - filterpresets
          - importexclusions
    - name: id
      in: path
      required: true
      schema:
        type: string
  put:
    tags: [Playnite]
    summary: Upsert entity (idempotent)
    security:
      - XAuthEmail: []
        XAuthPassword: []
        XClientId: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "../components/schemas.yaml#/EntityBody"
    responses:
      "201":
        description: Created
        content:
          application/json:
            schema:
              type: object
              properties:
                ok: { type: boolean }
                id: { type: string }
                collection: { type: string }
                created: { type: boolean }
      "200":
        description: Updated
        content:
          application/json:
            schema:
              type: object
              properties:
                ok: { type: boolean }
                id: { type: string }
                collection: { type: string }
                created: { type: boolean }
      "204":
        description: No change (payload identical)
      "400":
        description: Invalid input
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "403":
        description: Forbidden (admin required)
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
  delete:
    tags: [Playnite]
    summary: Delete entity (idempotent)
    security:
      - XAuthEmail: []
        XAuthPassword: []
        XClientId: []
    responses:
      "204":
        description: Deleted or absent
      "400":
        description: Invalid input
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "403":
        description: Forbidden (admin required)
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"

playnite_media:
  parameters:
    - name: path
      in: path
      required: true
      schema:
        type: string
        description: >
          Relative path under the media root (libraryfiles). Encode slashes if
          tooling cannot send wildcard segments (e.g. `%2F`).
  get:
    tags: [Playnite]
    summary: Download media (binary)
    description: >
      Download a media file from the libraryfiles tree. The `path` is the
      relative path under the media root. Encode slashes in `{path}` if your
      tooling cannot send wildcard path segments (e.g. `%2F`).
    security:
      - XAuthEmail: []
        XAuthPassword: []
        XClientId: []
    responses:
      "200":
        description: Media file stream
        content:
          application/octet-stream:
            schema:
              type: string
              format: binary
      "400":
        description: Invalid path
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "404":
        description: File not found
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "500":
        description: Error streaming media
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
  put:
    tags: [Playnite]
    summary: Upload media (binary)
    description: >
      Upload a media file into the libraryfiles tree. **Note:** encode slashes in
      `{path}` if your tooling cannot send wildcard path segments (e.g. `%2F`).
    security:
      - XAuthEmail: []
        XAuthPassword: []
        XClientId: []
    requestBody:
      required: true
      content:
        application/octet-stream:
          schema:
            type: string
            format: binary
        multipart/form-data:
          schema:
            type: object
            properties:
              file:
                type: string
                format: binary
    responses:
      "201":
        description: Created
        content:
          application/json:
            schema:
              type: object
              properties:
                ok: { type: boolean }
                bytes: { type: integer }
      "200":
        description: Overwritten
        content:
          application/json:
            schema:
              type: object
              properties:
                ok: { type: boolean }
                bytes: { type: integer }
      "204":
        description: No change (size/hash match)
      "400":
        description: Invalid path or empty body
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "401":
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
      "403":
        description: Forbidden (admin required)
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
